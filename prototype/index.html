<!DOCTYPE HTML>
<html>
    <head>
        <meta charset="UTF-8">
        <link rel="icon" href="images/favicon-16x16.png" sizes="16x16" type="image/png">
        <link rel="icon" href="images/favicon-32x32.png" sizes="32x32" type="image/png">
        <link rel="icon" href="images/favicon-48x48.png" sizes="48x48" type="image/png">
        <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1">
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <title>Heritage Near Me</title>
        <link rel="stylesheet" type="text/css" href="style.css">
        <link rel="stylesheet" type="text/css" href="css/loaders.min.css">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />
        <script src="https://npmcdn.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>

        <script src="https://use.typekit.net/tzz4als.js"></script>
        <script>try{Typekit.load({ async: true });}catch(e){}</script>
        <script type="text/javascript" src="swipe-local-history.js"></script>
    </head>
    <body>
        <!-- preload font awesome -->
        <i style="color:transparent; opacity: 0.001; position: absolute;" class="fa fa-times"> </i>

        <div id="elm"></div>
        <div class="map-container">
            <div id="map"></div>
        </div>


        <script type="text/javascript">
            // Make :active work in mobile safari
            document.addEventListener("touchstart", function(){}, true);

            window.addEventListener("load",function() {
                // Set a timeout...
                setTimeout(function() {
                    // Hide the address bar!
                    window.scrollTo(0, 1);
                }, 0);
            });

            // Start app
            var node = document.getElementById("elm");
            var app = Elm.embed(Elm.Main, node, {
                geolocation: null,
            });

            // Set up user geolocation
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(updateLocation, noLocation);
            } else {
                noLocation();
            }

            function updateLocation(position) {
                    app.ports.geolocation.send({
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    });
            }

            function noLocation() {
                app.ports.geolocation.send(null);
            }

            /* show map when Elm wants us to */
            mapEl = document.getElementById("map");
            app.ports.showMap.subscribe(function(showMap) {
                console.log("show map: " + showMap);
                if (showMap) {
                    mapEl.style.zIndex = '2';

                } else {
                    mapEl.style.zIndex = '-1';
                }
            });


            function setupMap() {

                var map = L.map('map').setView([-33.868820, 151.209296], 13);

                L.tileLayer('https://api.tiles.mapbox.com/v4/mapbox.emerald/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoidGVjaGllc2hhcmsiLCJhIjoiYzk2ZEFWTSJ9.8ZY6rG2BWXkDBmvAPvn_nw', {
                    attribution: 'Mapbox <a href="https://mapbox.com/about/maps" target="_blank">Terms &amp; Feedback</a>'
                }).addTo(map);

                // Latitude: N (+90), S (-90)
                // Longitude: E (+180) / W (-180)
                L.marker([-33.9, 151.209296]).addTo(map)
                    .bindPopup('A pretty CSS3 popup.<br> Easily customizable.')
                    .openPopup();
            }

            setupMap();


            /* preload images - define and run immediately */
            function preloadImages() {
                images = [
                        { url: "/images/logo.png"},
                        { url: "/images/splash-background.jpg"},
                        { url: "/images/splash-hero-image.png"},
                        { url: "/images/splash-site-logo.png"},
                    ];

                for (var i = 0; i < images.length; ++i) {
                     var img = new Image();
                     img.src = images[i]['url'];
                }
            };

            preloadImages();
        </script>
    </body>
</html>
